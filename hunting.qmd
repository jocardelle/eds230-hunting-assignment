---
title: "Hunting and predator prey dynamics"
author: "Haylee Oyler & Josephine Cardelle"
format: 
  html:
    embed-resources: true
execute:
  warning: false
  message: false
editor_options: 
  chunk_output_type: console
---

```{r}
library(deSolve)
library(ggpubr)
library(tidyverse)
library(sensitivity)
library(lhs)
library(purrr)
library(ggpubr)
library(here)
```

```{r}
source(here("lotvhuntmod_haylee.R"))
```
## Part 2

We chose to define stability as prey populations above 200 and predator populations above 20 after 100 years. We kept the 10:1 ratio of prey:predator that matched the initial conditions we went over in class. It makes sense that there would be much more prey than predators, and we're hoping both populations would increase over time. 

Explore how different hunting levels and different minimum prey populations (before hunting is allowed) are likely to effect the stability of the populations of both predator and prey.


A key challenge is how you might want to define stability? It is up to you but you will need to write a sentence to explain why you chose the measure that you did. 

It is up to you how you "explore" hunting  - you can simply try different values of the parameters in your hunting model or do it more formally by running your model across a range of values. You could think about parameter interactions

You can assume the following are best guesses of key parameters

rprey=0.95, alpha=0.01, eff=0.6,pmort=0.4, K=2000,

```{r}
# Base parameters given in the assignment
base_params <- c(rprey = 0.95, alpha = 0.01, eff = 0.6, pmort = 0.4, K = 2000)
pars <- c(base_params, rhunt = 0.01, prey_min = 50)
currpop <- c(prey = 100, pred = 10)
days <- seq(0, 100, by = 1)

# Run the ode model
res <- ode(y = currpop, times = days, func = lotvhunt, parms = pars)
res_df <- as.data.frame(res)
colnames(res_df) <- c("time", "prey", "pred")

res_long <- res_df %>%
    pivot_longer(cols = c(prey, pred), names_to = "species", values_to = "population")

# View the population changes over time
ggplot(res_long, aes(x = time, y = population, color = species)) +
    geom_line() +
    labs(title = "Predator and Prey Populations Over Time",
        x = "Time (days)",
        y = "Population",
        color = "Species") +
    theme_minimal()
```

## Grid Search Method
```{r}
rhunt_vals <- seq(0.001, 0.02, length.out = 15)
prey_min_vals <- seq(100, 400, length.out = 15)

param_grid <- expand.grid(rhunt = rhunt_vals, prey_min = prey_min_vals)
```


```{r}
results <- param_grid %>%
  mutate(
    stable = map2_lgl(rhunt, prey_min, function(rh, pm) {
      pars <- c(base_params, rhunt = rh, prey_min = pm)
      out <- tryCatch({
        df <- as.data.frame(ode(y = currpop, times = days, func = lotvhunt, parms = pars))
        final <- df[nrow(df), ]
        return(final$prey > 200 & final$pred > 20)
      }, error = function(e) {
        return(FALSE)
      })
      return(out)
    })
  )
```

```{r}
# Plot the results
ggplot(results, aes(x = prey_min, y = rhunt, z = as.numeric(stable))) +
  geom_contour_filled(breaks = c(-Inf, 0.5, Inf)) +
  scale_fill_manual(values = c("red", "green"), labels = c("Unstable", "Stable")) +
  labs(title = "Stability by Hunting Parameters",
       x = "Minimum Prey for Hunting",
       y = "Hunting Rate",
       fill = "Stability") +
  theme_minimal()

# Nothing is stable?
```



## Scenario Method

### Scenario 1: Low hunting rate, high threshold, Scenario 2: Reasonable hunting, Scenario 3: Higher hunting, Scenario 4: Very high hunting
```{r}
# Different values for parameters 
scenarios <- tibble(
  name = c("Low hunt", "Moderate hunt", "High Hunt", "Extreme Hunt"),
  rhunt = c(0.002, 0.01, 0.05, 0.1),
  prey_min = c(400, 300, 200, 100)
)

results <- scenarios %>%
  mutate(
    output = map2(rhunt, prey_min, function(rh, pm) {
      pars <- c(base_params, rhunt = rh, prey_min = pm)
      as.data.frame(ode(y = currpop, times = days, func = lotvhunt, parms = pars))
    })
  )

# Plot the scenarios
results_long <- results %>%
  mutate(name = factor(name, levels = name)) %>%
  unnest(output) %>%
  pivot_longer(cols = c(prey, pred), names_to = "species", values_to = "population")

ggplot(results_long, aes(x = time, y = population, color = species)) +
  geom_line() +
  facet_wrap(~ name, ncol = 2) +
  labs(title = "Population Dynamics Under Different Hunting Scenarios",
       x = "Time (days)", y = "Population") +
  theme_minimal()
```

